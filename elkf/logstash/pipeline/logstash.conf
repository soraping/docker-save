input {
    beats {
        port => 5044
    }
}

# 过滤
filter {
    if[app_name] == "derui" {
        grok {
            match => { "message" => "\s*\[\s*%{WORD:level}\s*\]\s*date\[%{TIMESTAMP_ISO8601:timestamp}:\]\s* host\[%{URIHOST:http_host}\]\s* ip\[%{IP:clientIp}\]\s* logId\[%{INT:logId}\]\s* uri\[(?<request>[\w,/]+)\]\s* time_used\[\d+\]\s* %{GREEDYDATA:msg}" }
        }
        mutate {
            rename => {"msg" => "msgInfo"}
            remove_field => ["port"]
        }
    }


    date {
        match => ["timestamp", "yyyy-MM-dd HH:mm:ss","ISO8601"]
        target => "@timestamp"
        timezone => "Asia/Shanghai"
    }
}

# 输出到es
output {
    stdout {
        codec => rubydebug
    }

    if[app_name] == "derui" {
        elasticsearch {
            hosts => ["http://es:9200"]
            user => "elastic"
            password => "123456"
            # 索引名称，这里获取filebeat设置的参数
            index => "derui-%{+YYYY.MM.dd}"
            codec  => "json"
        }
    }





}